{"version":3,"sources":["App.js","index.js"],"names":["App","props","pickedTracks","vkId","telegramId","permission","hash","icon","API_URL","refs","setSnackbar","setState","snackbar","layout","onClose","before","size","style","backgroundColor","fill","width","height","onCheckboxChange","e","track","JSON","parse","currentTarget","dataset","index","url","title","artist","sendTracks","a","bridge","send","then","res","result","catch","fetch","json","setActiveModal","filteredPickedTracks","method","headers","body","stringify","activeModal","filter","state","scheme","tracks","isShowButton","isLoading","isAllChecked","subscribe","detail","type","data","id","keys","value","console","log","response","key","Array","length","map","createRef","modal","this","modalBack","header","caption","marginTop","mode","href","target","activePanel","left","onClick","marginBottom","marginRight","background","album","thumb","photo_68","backgroundSize","after","data-track","onChange","description","vertical","wide","React","Component","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.b607b140.chunk.js","sourcesContent":["import React, { createRef, useRef } from 'react';\r\nimport bridge from '@vkontakte/vk-bridge';\r\nimport { View, Panel, PanelHeader, Div, Card, SimpleCell, Checkbox, ConfigProvider, FixedLayout, Button, Separator, PanelHeaderButton, ModalRoot, ModalCard, Snackbar, Avatar, Spinner } from '@vkontakte/vkui';\r\nimport Icon16Done from '@vkontakte/icons/dist/16/done';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport './App.css';\r\n\r\nclass App extends React.Component {\r\n\tpickedTracks = [];\r\n\tvkId = null;\r\n\ttelegramId = null;\r\n    permission = true;\r\n    hash = null;\r\n\ticon = 'data:image/svg+xml;charset=utf-8,%3Csvg%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20width%3D%2224%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cpath%20d%3D%22m0%200h24v24h-24z%22%20opacity%3D%22.4%22%2F%3E%3Cpath%20d%3D%22m13%2011.4849987v5.6482897c0%204.5123987-.8747233%205.3834431-4.37440289%205.8421935-1.6682259.2186769-3.62559711-.5384568-3.62559711-3.1617096%200-1.2814037.80181302-2.498263%202.46114282-2.8162494%201.26723039-.2428462-.09078118.0181935%202.77607228-.5140396.6959753-.1292083.7748413-.3782301.7748413-.908791%200-.2664094-.0013183-2.5951438-.0022416-4.1936475l-.0073943-.0003862v-4.31781414s-.0054461-2.05827203%200-3.08739758c.0065136-1.23086488.6796458-1.68321833%202.6637921-2.08397579%200%200%203.0232113-.57396781%204.6852252-.87541989.367783-.06670761.6485622.07018054.6485622.49202579%200%200-.0106774%202.62210108%200%204.05433854.0031006.41590408-.168424.60420104-.5899711.67902227-1.6816987.29848801-4.8649278.86036181-4.8649278.86036181-.3738792.09182758-.5451011.35499958-.5451011.73329156z%22%20fill%3D%22%236f99c8%22%20fill-rule%3D%22nonzero%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E';\r\n    API_URL = 'https://s23209.h10.modhost.pro';\r\n    refs = [];\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.state = {\r\n\t\t\tscheme: 'bright_light',\r\n\t\t\ttracks: [],\r\n            activeModal: null,\r\n            snackbar: null,\r\n            isShowButton: false,\r\n            isLoading: true,\r\n            isAllChecked: false\r\n\t\t};\r\n\t}\r\n\r\n    setSnackbar = () => {\r\n        this.setState({ snackbar:\r\n        <Snackbar\r\n            layout=\"vertical\"\r\n            onClose={() => this.setState({ snackbar: null })}\r\n            before={<Avatar size={24} style={{ backgroundColor: 'var(--accent)' }}><Icon16Done fill=\"#fff\" width={14} height={14} /></Avatar>}\r\n        >\r\n            –ú—É–∑—ã–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏–ª–∞—Å—å. –ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è üéß\r\n        </Snackbar>\r\n        });\r\n    }\r\n\r\n\tonCheckboxChange = (e) => {\r\n\t\tconst track = JSON.parse(e.currentTarget.dataset.track);\r\n\t\tthis.pickedTracks[track.index] = this.pickedTracks[track.index] ? null : { url: track.url, title: track.title, artist: track.artist };\r\n        // this.setState({ isShowButton: !!this.filteredPickedTracks().length })\r\n\t}\r\n\r\n\tsendTracks = async () => {\r\n        if (!this.permission) {\r\n            return await bridge.send('VKWebAppJoinGroup', {'group_id': 184374271})\r\n                            .then((res) => this.permission = res.result)\r\n                            .catch(() => this.permission = false);;\r\n        }\r\n\r\n        if (!this.telegramId) {\r\n            this.hash = (await fetch(`${this.API_URL}/getHash?id=${this.vkId}`).then(res => res.json())).hash;\r\n            return this.setActiveModal('TelegramAuth');\r\n        }\r\n\r\n\t\tconst filteredPickedTracks = this.filteredPickedTracks();\r\n\t\t\r\n        this.setSnackbar();\r\n\r\n\t\tfetch(`${this.API_URL}/sendTracks?id=${this.telegramId}`, {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t  \t\t'Content-Type': 'application/json'\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify(filteredPickedTracks),\r\n\t\t})\r\n\t}\r\n\r\n    setActiveModal = (activeModal) => {\r\n        this.setState({ activeModal });\r\n    };\r\n\r\n    filteredPickedTracks = () => {\r\n        return this.pickedTracks.filter(track => !!track)\r\n    }\r\n\r\n\tasync componentDidMount() {\r\n\t\tbridge.subscribe(async ({ detail: { type, data }}) => {\r\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\r\n\t\t\t\tthis.setState({ scheme: data.scheme });\r\n\t\t\t} else if (type === 'VKWebAppInitResult') {\r\n                this.vkId = (await bridge.send(\"VKWebAppGetUserInfo\", {})).id;\r\n\r\n                await bridge.send('VKWebAppJoinGroup', {'group_id': 184374271})\r\n                        .then((res) => this.permission = res.result)\r\n                        .catch(() => this.permission = false);\r\n\t\t\t\t\r\n\t\t\t\tthis.telegramId = (await bridge.send('VKWebAppStorageGet', { keys: ['telegramId'] })).keys[0].value;\r\n                console.log(this.telegramId);\r\n\r\n                if (this.telegramId === 'null') {\r\n                    const response = await fetch(`${this.API_URL}/getUser?id=${this.vkId}`).then(res => res.json());\r\n                    this.telegramId = response.telegramId;\r\n                    console.log(this.telegramId);\r\n\r\n                    if (!this.telegramId) {\r\n                        this.hash = (await fetch(`${this.API_URL}/getHash?id=${this.vkId}`).then(res => res.json())).hash;\r\n                        this.setActiveModal('TelegramAuth');\r\n                    } else {\r\n                        await bridge.send('VKWebAppStorageSet', { key: 'telegramId', value: `${this.telegramId}` });\r\n                    }\r\n                }\r\n\r\n\t\t\t\tfetch(`${this.API_URL}/getTracks?id=${this.vkId}`)\r\n\t\t\t\t\t.then(res => res.json())\r\n\t\t\t\t\t.then(result => {\r\n\t\t\t\t\t\tthis.pickedTracks = new Array(result.tracks.length);\r\n                        this.refs = this.pickedTracks.map(() => createRef());\r\n\t\t\t\t\t\tthis.setState({ tracks: result.tracks, isLoading: false })\r\n\t\t\t\t\t})\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\trender() {\r\n        const modal = (<ModalRoot\r\n                        activeModal={this.state.activeModal}\r\n                        onClose={this.modalBack}\r\n                      >\r\n                        <ModalCard\r\n                            id={ 'TelegramAuth' }\r\n                            onClose={() => this.setActiveModal(null)}\r\n                            header='–ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–µ'\r\n                            caption='–ß—Ç–æ–±—ã —è —Å–º–æ–≥ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–±–µ —Ç—Ä–µ–∫ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –Ω–µ–º'\r\n                        >\r\n                            <Button \r\n                                style={{ marginTop: 16 }} \r\n                                mode='secondary' size='xl' \r\n                                href={ `https://t.me/ilushaR_bot?start=${this.vkId}-${this.hash}` }\r\n                                target='_blank'\r\n                            >\r\n                                Telegram Authorization üîì\r\n                            </Button>\r\n                        </ModalCard>\r\n                      </ModalRoot>)\r\n\r\n\t\treturn (\r\n\t\t\t<ConfigProvider scheme={ this.state.scheme }>\r\n\t\t\t\t<View activePanel='main' modal={ modal }>\r\n\t\t\t\t\t<Panel id='main'>\r\n                        <PanelHeader \r\n                            left={\r\n                                <PanelHeaderButton onClick={ async () => {\r\n                                    // console.log(this.refs);\r\n                                    // this.refs.forEach(checkbox => {\r\n                                    //     console.log(checkbox);\r\n                                    // })\r\n                                    // this.pickedTracks = this.state.isAllChecked ? [] : this.state.tracks;\r\n                                    // this.setState({ isAllChecked: !this.state.isAllChecked, isShowButton: !this.state.isAllChecked  });\r\n                                } \r\n                                }>\r\n                                    { this.state.isAllChecked ? '–û—Ç–º–µ–Ω–∏—Ç—å' : '–í—ã–±—Ä–∞—Ç—å' } –≤—Å–µ\r\n                                </PanelHeaderButton>\r\n                            }\r\n                        >\r\n                            Audio Bot\r\n                        </PanelHeader>\r\n                        { this.state.isLoading \r\n                            ? <Spinner size=\"large\" style={{ marginTop: 20 }} />\r\n                            : <Div style={{ marginBottom: this.state.isShowButton ? 40 : 0 }}>\r\n\t\t\t\t\t\t        { this.state.tracks.map((track, index) => \r\n                                    <SimpleCell \r\n                                        key={ track.id }\r\n                                        before={\r\n                                            <Card \r\n                                                size='m' \r\n                                                style={{ width: 40, height: 40, marginRight: 10, background: `url(${ track.album && track.album.thumb ? track.album.thumb.photo_68 : this.icon}) no-repeat center #e5ebf1`, backgroundSize: 'cover'}} \r\n                                            />\r\n                                        } \r\n                                        after={ <Checkbox \r\n                                                    data-track={JSON.stringify({ index, url: track.url, title: track.title, artist: track.artist })} \r\n                                                    onChange={ this.onCheckboxChange } \r\n                                                /> } \r\n                                        description={ track.artist } \r\n                                    >\r\n                                        { track.title } \r\n                                    </SimpleCell>\r\n\t\t\t\t\t\t        )}\r\n                              </Div>\r\n                        }\r\n                        { this.state.isShowButton && \r\n\t\t\t\t\t\t<FixedLayout vertical='bottom'>\r\n\t\t\t\t\t\t\t<Separator wide />\r\n\t\t\t\t\t\t\t<Button \r\n                                onClick={ this.sendTracks } \r\n                                size='xl'\r\n                            >\r\n                                –°–∫–∞—á–∞—Ç—å\r\n                            </Button>\r\n\t\t\t\t\t\t</FixedLayout> }\r\n                        { this.state.snackbar }\r\n\t\t\t\t\t</Panel>\r\n\t\t\t\t</View>\r\n\t\t\t</ConfigProvider>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default App;","import \"core-js/features/map\";\r\nimport \"core-js/features/set\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport bridge from \"@vkontakte/vk-bridge\";\r\nimport App from \"./App\";\r\n\r\nbridge.send(\"VKWebAppInit\");\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}